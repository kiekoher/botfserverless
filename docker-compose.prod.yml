services:
  whatsapp-gateway:
    build:
      context: ./services/whatsapp-gateway
      dockerfile: Dockerfile
    image: ${DOCKERHUB_USERNAME}/eva-whatsapp-gateway:${WHATSAPP_GATEWAY_TAG:-latest}
    container_name: eva_whatsapp_gateway_prod
    restart: unless-stopped
    mem_limit: 768m
    cpus: '0.75'
    environment:
      # Variables to be set in .env.prod file
      - MAIN_API_URL=${MAIN_API_URL}
      - R2_ENDPOINT_URL=${R2_ENDPOINT_URL}
      - R2_BUCKET_NAME=${R2_BUCKET_NAME}
      - R2_ACCESS_KEY_ID=${R2_ACCESS_KEY_ID}
      - R2_SECRET_ACCESS_KEY=${R2_SECRET_ACCESS_KEY}
      - WHATSAPP_USER_ID=${WHATSAPP_USER_ID}
    volumes:
      - whatsapp_session_prod:/app/session
    healthcheck:
      test: ["CMD-SHELL", "curl -f http://localhost:9100/health || exit 1"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 30s

volumes:
  whatsapp_session_prod:
